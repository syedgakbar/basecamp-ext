chrome.pageAction.onClicked.addListener(function(){alert("Show Preferences")});function ExecuteScriptInAllTabs(b){chrome.windows.getAll({populate:true},function(a){for(var c in a){var d=a[c].tabs;for(var f in d){var g=d[f].url,e=/https?:\/\/.*basecamphq\.com/gi;e.compile(e);e.test(g)&&chrome.tabs.executeScript(d[f].id,{code:b})}}})}String.prototype.replaceAll=function(b,a){return this.replace(new RegExp(b,"g"),a)};
chrome.extension.onRequest.addListener(function(b,a,c){switch(b.message){case "ShowPageAction":if(a.tab){chrome.pageAction.setIcon({tabId:a.tab.id,path:b.extensionEabled?"default_icon.png":"default_icon_gs.png"});chrome.pageAction.show(a.tab.id)}break;case "Extension_LoadPreferences":if(preferences=localStorage.basecampExtPreferences)preferences=JSON.parse(preferences);c({preferences:preferences});break;case "Extension_SavePreferences":localStorage.basecampExtPreferences=JSON.stringify(b.preferences);
ExecuteScriptInAllTabs("BasecampExt.LoadPreferences();");break}});
